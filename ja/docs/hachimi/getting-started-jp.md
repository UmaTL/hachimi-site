# インストールガイド（日本語版の場合）

以下のプラットフォームごとのガイドに従ってから、[初期セットアップ](#初期セットアップ)に進んでください。

## Windows

2025/9/24 の大型アップデート以降、v0.14.2 以降の Hachimi Edge を使用する必要があります。
もし問題が発生したら、[トラブルシューティング](troubleshooting.md)をご確認ください。

::: warning
Vanguard などの一部のアンチチートは、保護対象のゲームに直接影響を与えない場合であっても、システム上で DLL リダイレクトが有効になっている場合、問題とみなす可能性があります。Vanguard や、同様のチェックを行う他のアンチチートを使用しているゲームをプレイする際には、必ず DLL リダイレクトを無効にしてください。[こちらのプログラムを使用すると](https://github.com/LeadRDRK/DotLocalToggle/releases)、簡単に有効化や無効化ができます。プログラムを実行し、 DLL リダイレクトが無効化されたと表示されたら、コンピューターを再起動してください。
:::
::: info
「.local」は、DMM版でのみ使用されます。Steam版では使用されません。
:::

1. [最新版のインストーラー](https://github.com/kairusds/Hachimi-Edge/releases/latest/download/hachimi_installer.exe)をダウンロードし、実行します。
1. もし通常版の Hachimi（Hachimi Edge ではないバージョン）をご使用中の場合は、先に「Uninstall」を選択してください。
1. ゲームのバージョンを下側の項目から選択してください。
1. 必要に応じて、インストールディレクトリが正しく設定されているかを確認、修正してください。
1. 「Install」を選択し、インストールします。

初めてインストールする際に、インストーラーが「.local」フォルダを使った DLL リダイレクトを有効にするように確認する場合があります。「OK」をクリックすると有効になります。**動作させるためには、有効にした後、コンピューターを再起動（シャットダウンではありません）する必要があります。**

<details>
<summary class="collapsible-header-sub">手動でインストールする方法</summary>

::: tip
名前を変更する際には、元のファイル名に**ファイル拡張子（`.exe`、`.dll`）が含まれている場合にのみ**拡張子を追加してください。含まれていない場合は、拡張子を非表示にするように設定されているため、名前変更後の実際のファイル名が `.exe.exe` で終わってしまい、ゲームが動作しなくなります。（フォルダに関しては関係ありません。）
:::

::: tip
ガイドは DMM 版を例にしています。Steam 版をご使用の場合は、以下の `umamusume.exe` の部分を `UmamusumePrettyDerby.exe` と読み替えてください。
:::

1. [こちらの記事](https://learn.microsoft.com/ja-jp/windows/win32/dlls/dynamic-link-library-redirection#optional-configure-the-registry)の「レジストリを構成する」を参考にし、 DLL リダイレクトを有効にしてから、コンピューターを再起動します。
1. 最新バージョンの `hachimi.dll` を[リリースページ](https://github.com/kairusds/Hachimi-Edge/releases)からダウンロードします。
1. ゲームがインストールされているフォルダ内に `umamusume.exe.local` という名前の新しいフォルダを作成して、ダウンロードした DLL ファイルをそこに移動し、ファイル名を `UnityPlayer.dll` に変更します。
1. 最新バージョンの `cellar.dll` を[Cellarのリリースページ](https://github.com/Hachimi-Hachimi/Cellar/releases)からダウンロードします。
1. ダウンロードしたファイルを `umamusume.exe.local` フォルダに移動し、`apphelp.dll` に名前を変更してください。

</details>

<details>
<summary class="collapsible-header-sub">非推奨のプラグインのシミング方法からの移行</summary>

まず、Shinmy を完全にアンインストールする必要があります。 DMM を終了しても Shinmy は最大30秒間起動し続け、その間であれば自動的に復元されるため、削除する際には Shinmy が起動していないことを確認してください。**一番簡単な方法はインストーラーを使用することです**（アンインストーラーとしても動作するため）。インストーラーを使用すると、すべてが自動的にクリーンアップされます。

これらの手順が終わったあとは、Hachimi を通常通りアンインストールできます。
</details>

## Android

::: warning
Android にパッチをしたゲームをインストールすると、そのゲームでは Google Play Store の機能が使用できなくなり、アプリ内購入なども使用できなくなります。その場合、ゲームデベロッパーのストアをご利用ください。
:::

::: danger
パッチ適用前のゲームのセーブデータがすでにある場合はあらかじめ、データ連携、またはCygames ID を使用してアカウントのデータを同期してください。パッチの適用後は、このゲームで Google Play アカウントを使用することはできません。
:::

::: danger
もしすでに*パッチされていない*ゲームをインストールしている場合は、先にアンインストールを行ってください。パッチ適用後はアンインストールすることなくゲームをアップデートできます。
:::

::: warning
APKPure からダウンロードした APK は使用しないでください。不具合の発生が報告されています。
[Qoopy](https://qoopy.leadrdrk.com/) を利用することが推奨されています。ゲームの ID は「6172」です。
:::

::: tip
HyperOS が搭載されていない Xiaomi デバイスでは、インストールする前に MIUI の最適化を無効にしてみてください。
:::

1. もしこれまでに ウマPatcher を使用したことがある場合、設定ページを開き、**「Export signing key」を選択し、安全な場所に保存してください。**
1. **ウマPatcher を使用してパッチをしていないゲームをインストールしている場合は**、ゲームをアンインストールしてください。
1. 最新バージョンの [ウマPatcher Edge](https://github.com/kairusds/UmaPatcher-Edge/releases/latest/download/app-release.apk) をダウンロードし、インストールします。
1. ゲームのインストールパッケージを準備します。パッケージの形式は以下のとおりです。
    - **分割 APK ファイル**: ベース APK ファイルと、いずれか1つの分割構成 APK ファイル（例: config.arm64_v8a、config.armeabi-v7aなど）です。
 お使いの端末に適した構成 APK ファイルを1つ選択してください。
 これは現在、日本語版でのみ使用されています。
    - **単一 APK ファイル**: すべての構成を含んだフルサイズの APK ファイルです。
    - **XAPK ファイル**: 分割 APK ファイルを ZIP 形式でまとめ、拡張子を XAPK に変更したファイルです。
1. ウマPatcher を開き、必要に応じて「Import signing key」を選択し、先に保存したファイルをインポートし、「Normal install」を選び、準備したファイル（単一または複数）を選択します。
1. 「Patch」をタップすると、パッチ適用とインストールが行われます。

⚠️ アップデートをする際は、上記の手順4から行ってください。ゲームをアップデートするたびにアンインストールする必要はありません。

<details>
<summary class="collapsible-header-sub">アンインストールなしにパッチを適用 + ストアでのアップデートが可能な方法（ root 権限が必要）</summary>

ウマPatcher には root 化済みのユーザーのためのインストールオプションがあり、ゲームをアンインストールすることなく、アプリストアから通常通りアップデートできます。

ゲームをインストールしたら、ホーム画面上部のカードをタップして、パッチを適用したいアプリ（必要な場合）を選択します。インストール方法として「Direct install」を選択し、「Patch」をタップします。ファイルを選択する必要はありません。

ゲームがアップデートされるたびに、再度 ウマPatcher を使用してパッチを適用する必要があります。
</details>

<details>
<summary class="collapsible-header-sub">手動でインストールする方法（非推奨）</summary>

1. ビルドをするか、ビルド済みライブラリを[リリースページ](https://github.com/kairusds/Hachimi-Edge/releases)からダウンロードします。
1. ゲームの APK ファイルを抽出します。[apktool](https://apktool.org/)を使用することを推奨します。
1. `lib` フォルダ内の各フォルダにある `libmain.so` ファイルの名前を `libmain_orig.so` に変更します。
1. プロキシライブラリを対応するフォルダにコピー（例： `libmain-arm64-v8a.so` は `lib/arm64-v8a` にコピー）し、名前を `libmain.so` に変更します。
1. APK ファイルをビルドし、インストールします。

</details>

## 初期セットアップ

Hachimi をインストールした後、初めてゲームを起動すると、次のダイアログが表示されます。

![First Time Setup](/assets/first-time-setup.jpg)

::: warning
Hachimi Edge にアップグレードした際に表示されない場合は、Hachimi のメニューを表示し、セットアップを完了させてください。古い翻訳や壊れたテクスチャなどの問題が発生する可能性があります。
:::

::: info
もし表示されない場合は、Hachimi が正しくインストールされていない可能性があります。インストール方法をご確認の上、もう一度お試しいただくか、[トラブルシューティング](troubleshooting.md)をご確認ください。
:::

「Next」をタップして翻訳リポジトリを選択してください。「Done」をタップすると設定が保存され、アップデートのチェックが開始されます。

その後、翻訳のアップデートをダウンロードするように要求されます。「Yes」を選択すると、翻訳ファイルのダウンロードが開始されます。

後からこのダイアログに戻り、Hachimi のメニューから翻訳ソースを変更できます。
